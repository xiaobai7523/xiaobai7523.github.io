<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>客房打扫数据收集系统</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        header {
            background: linear-gradient(90deg, #4b6cb7 0%, #182848 100%);
            color: white;
            padding: 25px 30px;
            text-align: center;
            border-bottom: 5px solid #ff7e5f;
            position: relative;
        }

        header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .user-info {
            position: absolute;
            top: 15px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .user-badge {
            background: #ff7e5f;
            padding: 2px 8px;
            border-radius: 10px;
            font-weight: 600;
            font-size: 0.8rem;
        }

        .admin-badge {
            background: #4CAF50;
        }

        .tabs {
            display: flex;
            background: #f1f3f9;
            border-bottom: 2px solid #e1e5ee;
        }

        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .tab.active {
            background: white;
            border-bottom: 3px solid #4b6cb7;
            color: #4b6cb7;
        }

        .tab:hover:not(.active) {
            background: #e9ecf5;
        }

        .tab-content {
            display: none;
            padding: 30px;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 25px;
        }

        .section-title {
            font-size: 1.3rem;
            color: #182848;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e1e5ee;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group.wide {
            grid-column: span 2;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #444;
            font-size: 0.9rem;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e5ee;
            border-radius: 10px;
            font-size: 15px;
            transition: all 0.3s ease;
            background: #f9fafc;
        }

        input:focus, select:focus, textarea:focus {
            border-color: #4b6cb7;
            outline: none;
            box-shadow: 0 0 0 3px rgba(75, 108, 183, 0.2);
            background: white;
        }

        /* 数字输入框特殊样式 */
        .number-input {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid #e1e5ee;
            border-radius: 10px;
            font-size: 16px;
            text-align: center;
            font-weight: 600;
            background: #f9fafc;
            transition: all 0.3s ease;
        }

        .number-input:focus {
            border-color: #4b6cb7;
            background: white;
            box-shadow: 0 0 0 3px rgba(75, 108, 183, 0.2);
        }

        .number-input::-webkit-inner-spin-button,
        .number-input::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .number-input[type="number"] {
            -moz-appearance: textfield;
        }

        /* 物品网格布局 */
        .items-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 12px;
            margin-top: 10px;
            min-height: 50px;
            background: #f9fafc;
            padding: 10px;
            border-radius: 8px;
            border: 2px dashed #e1e5ee;
        }

        .item-input-group {
            display: flex;
            flex-direction: column;
            background: white;
            border-radius: 8px;
            padding: 10px;
            transition: all 0.2s ease;
            border: 1px solid #e1e5ee;
        }

        .item-input-group:hover {
            background: #e9ecf5;
            border-color: #4b6cb7;
        }

        .item-input-group label {
            font-size: 0.85rem;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            text-align: center;
        }

        .item-input-group .number-input {
            padding: 8px 10px;
            font-size: 14px;
            text-align: center;
        }

        .quick-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .quick-btn {
            padding: 8px 15px;
            background: #f1f3f9;
            border: 1px solid #e1e5ee;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s ease;
        }

        .quick-btn:hover {
            background: #e9ecf5;
            border-color: #4b6cb7;
        }

        .btn-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        button {
            padding: 14px 25px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            flex: 1;
            min-width: 150px;
        }

        .btn-primary {
            background: linear-gradient(90deg, #4b6cb7 0%, #182848 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 15px rgba(75, 108, 183, 0.4);
        }

        .btn-secondary {
            background: #f1f3f9;
            color: #4b6cb7;
            border: 2px solid #4b6cb7;
        }

        .btn-secondary:hover {
            background: #4b6cb7;
            color: white;
        }

        .btn-danger {
            background: #ff6b6b;
            color: white;
        }

        .btn-danger:hover {
            background: #ff5252;
            transform: translateY(-3px);
        }

        .btn-success {
            background: #4CAF50;
            color: white;
        }

        .btn-success:hover {
            background: #45a049;
            transform: translateY(-3px);
        }

        .btn-time {
            background: #ff7e5f;
            color: white;
            flex: 0 0 auto;
            min-width: 120px;
        }

        .btn-time:hover {
            background: #ff6b4a;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border-left: 5px solid #4b6cb7;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: #4b6cb7;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #666;
            font-weight: 600;
        }

        .data-list {
            max-height: 500px;
            overflow-y: auto;
            background: white;
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .data-item {
            background: #f9fafc;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 12px;
            border-left: 4px solid #4b6cb7;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: all 0.2s ease;
        }

        .data-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0,0,0,0.1);
        }

        .data-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .data-room {
            font-size: 1.2rem;
            font-weight: 700;
            color: #182848;
        }

        .data-time {
            font-size: 0.9rem;
            color: #666;
        }

        .data-info {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #e1e5ee;
        }

        .data-field {
            font-size: 0.9rem;
        }

        .data-field .label {
            font-weight: 600;
            color: #555;
        }

        .data-field .value {
            color: #333;
            margin-left: 5px;
        }

        .data-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            justify-content: flex-end;
        }

        .data-actions button {
            flex: 0 0 auto;
            padding: 8px 15px;
            font-size: 0.85rem;
            min-width: auto;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #888;
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.3;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4CAF50;
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transform: translateX(120%);
            transition: transform 0.3s ease;
            z-index: 1000;
            max-width: 300px;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            background: #ff6b6b;
        }

        .notification.warning {
            background: #ff9800;
        }

        .filter-section {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: flex-end;
        }

        .filter-group {
            flex: 1;
            min-width: 200px;
        }

        .filter-group label {
            font-size: 0.85rem;
            margin-bottom: 5px;
        }

        .filter-group input, .filter-group select {
            padding: 8px 12px;
            font-size: 0.9rem;
        }

        .summary-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .summary-item {
            text-align: center;
            padding: 15px;
            background: #f9fafc;
            border-radius: 10px;
        }

        .summary-item .count {
            font-size: 1.5rem;
            font-weight: 700;
            color: #4b6cb7;
        }

        .summary-item .label {
            font-size: 0.85rem;
            color: #666;
            margin-top: 5px;
        }

        .progress-bar {
            height: 8px;
            background: #e1e5ee;
            border-radius: 4px;
            margin-top: 8px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4b6cb7 0%, #182848 100%);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        /* 酒店房间状态特殊样式 */
        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.85rem;
            font-weight: 600;
            color: white;
        }

        .status-vd { background: #ff6b6b; }
        .status-oc { background: #4CAF50; }
        .status-vc { background: #2196F3; }
        .status-small { background: #ff9800; }

        .status-legend {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 10px;
            padding: 10px;
            background: #f9fafc;
            border-radius: 8px;
        }

        .status-legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .status-legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .status-legend-dot.vd { background: #ff6b6b; }
        .status-legend-dot.oc { background: #4CAF50; }
        .status-legend-dot.vc { background: #2196F3; }
        .status-legend-dot.small { background: #ff9800; }

        /* 物品数量展示样式 */
        .items-summary-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .items-summary-item {
            background: #f9fafc;
            border-radius: 8px;
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .items-summary-item .name {
            font-weight: 600;
            color: #333;
        }

        .items-summary-item .count {
            background: #4b6cb7;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 700;
            min-width: 30px;
            text-align: center;
        }

        /* 登录/注册界面 */
        .auth-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 500px;
        }

        .auth-box {
            width: 100%;
            max-width: 400px;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
        }

        .auth-title {
            text-align: center;
            margin-bottom: 30px;
            color: #182848;
            font-size: 1.5rem;
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 25px;
            background: #f1f3f9;
            border-radius: 10px;
            overflow: hidden;
        }

        .auth-tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .auth-tab.active {
            background: #4b6cb7;
            color: white;
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .auth-form .form-group {
            margin-bottom: 20px;
        }

        .auth-form label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #444;
        }

        .auth-form input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e5ee;
            border-radius: 10px;
            font-size: 15px;
        }

        .auth-form input:focus {
            border-color: #4b6cb7;
            outline: none;
            box-shadow: 0 0 0 3px rgba(75, 108, 183, 0.2);
        }

        .auth-buttons {
            display: flex;
            gap: 10px;
            margin-top: 25px;
        }

        .auth-buttons button {
            flex: 1;
        }

        .auth-note {
            text-align: center;
            margin-top: 20px;
            font-size: 0.9rem;
            color: #666;
        }

        .auth-note a {
            color: #4b6cb7;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
        }

        .auth-note a:hover {
            text-decoration: underline;
        }

        /* 用户列表样式 */
        .user-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .user-card {
            background: #f9fafc;
            border-radius: 12px;
            padding: 20px;
            border-left: 5px solid #4b6cb7;
            transition: all 0.2s ease;
        }

        .user-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .user-card.admin {
            border-left-color: #4CAF50;
            background: #f1f8f5;
        }

        .user-card .user-name {
            font-size: 1.2rem;
            font-weight: 700;
            color: #182848;
            margin-bottom: 8px;
        }

        .user-card .user-role {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            color: white;
            margin-bottom: 10px;
        }

        .user-role.admin {
            background: #4CAF50;
        }

        .user-role.user {
            background: #2196F3;
        }

        .user-card .user-stats {
            display: flex;
            gap: 15px;
            margin-top: 10px;
            font-size: 0.9rem;
            color: #666;
        }

        .user-card .user-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            justify-content: flex-end;
        }

        .user-card .user-actions button {
            flex: 0 0 auto;
            padding: 6px 12px;
            font-size: 0.85rem;
            min-width: auto;
        }

        .user-card .user-actions button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* 管理员特定样式 */
        .admin-section {
            background: #fff8e1;
            border: 2px solid #ffc107;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .admin-section h3 {
            color: #ff9800;
            margin-bottom: 15px;
        }

        .admin-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        /* 登录状态指示器 */
        .login-status {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: #ff6b6b;
            color: white;
            padding: 10px;
            text-align: center;
            z-index: 999;
            display: none;
        }

        .login-status.show {
            display: block;
        }

        .login-status.success {
            background: #4CAF50;
        }

        /* 新增：导出所有数据按钮样式 */
        .btn-export-all {
            background: linear-gradient(90deg, #28a745 0%, #1e7e34 100%);
            color: white;
        }

        .btn-export-all:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 15px rgba(40, 167, 69, 0.4);
        }

        /* 新增：管理员数据导出区域 */
        .admin-export-section {
            background: #f8fff9;
            border: 2px solid #28a745;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .admin-export-section h3 {
            color: #28a745;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .admin-export-section p {
            color: #666;
            margin-bottom: 15px;
            font-size: 0.95rem;
        }

        .admin-export-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .admin-export-controls button {
            min-width: 200px;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }

            .form-group.wide {
                grid-column: span 1;
            }

            .data-info {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .btn-group {
                flex-direction: column;
            }

            button {
                width: 100%;
            }

            .status-legend {
                justify-content: center;
            }

            .items-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .user-list {
                grid-template-columns: 1fr;
            }

            .auth-box {
                padding: 25px;
            }

            .user-info {
                position: static;
                margin-top: 10px;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="login-status" id="loginStatus"></div>

    <!-- 登录/注册界面 -->
    <div id="auth-screen" class="container">
        <header>
            <h1><i class="fas fa-hotel"></i> 客房打扫数据收集系统</h1>
            <p>请登录或注册以继续</p>
        </header>

        <div class="auth-container">
            <div class="auth-box">
                <h2 class="auth-title">系统登录</h2>

                <div class="auth-tabs">
                    <div class="auth-tab active" onclick="switchAuthTab('login')">登录</div>
                    <div class="auth-tab" onclick="switchAuthTab('register')">注册</div>
                </div>

                <!-- 登录表单 -->
                <div id="login-form" class="auth-form active">
                    <div class="form-group">
                        <label>用户名</label>
                        <input type="text" id="login-username" placeholder="请输入用户名">
                    </div>
                    <div class="form-group">
                        <label>密码</label>
                        <input type="password" id="login-password" placeholder="请输入密码">
                    </div>
                    <div class="auth-buttons">
                        <button class="btn-primary" onclick="login()">
                            <i class="fas fa-sign-in-alt"></i> 登录
                        </button>
                    </div>
                    <div class="auth-note">
                        没有账号？<a onclick="switchAuthTab('register')">立即注册</a>
                    </div>
                </div>

                <!-- 注册表单 -->
                <div id="register-form" class="auth-form">
                    <div class="form-group">
                        <label>用户名</label>
                        <input type="text" id="register-username" placeholder="请输入用户名">
                    </div>
                    <div class="form-group">
                        <label>密码</label>
                        <input type="password" id="register-password" placeholder="请输入密码">
                    </div>
                    <div class="form-group">
                        <label>确认密码</label>
                        <input type="password" id="register-confirm" placeholder="请再次输入密码">
                    </div>
                    <div class="auth-buttons">
                        <button class="btn-success" onclick="register()">
                            <i class="fas fa-user-plus"></i> 注册
                        </button>
                        <button class="btn-secondary" onclick="switchAuthTab('login')">
                            <i class="fas fa-arrow-left"></i> 返回登录
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 主应用界面 -->
    <div id="app-screen" class="container" style="display: none;">
        <header>
            <h1><i class="fas fa-hotel"></i> 客房打扫数据收集系统</h1>
            <p>记录客房楼层服务员打扫详情，高效管理客房状态</p>
            <div class="user-info">
                <span id="current-user-name">用户名</span>
                <span id="user-role-badge" class="user-badge">用户</span>
                <button onclick="logout()" style="background: none; border: none; color: white; cursor: pointer; font-size: 0.9rem; padding: 0; margin-left: 10px;">
                    <i class="fas fa-sign-out-alt"></i> 退出
                </button>
            </div>
        </header>

        <div class="tabs" id="app-tabs">
            <!-- 动态生成标签页 -->
        </div>

        <!--打扫记录表单 -->
        <div id="form-tab" class="tab-content active">
            <div class="form-section">
                <h2 class="section-title"><i class="fas fa-user-tie"></i> 基本信息</h2>
                <div class="status-legend">
                    <div class="status-legend-item">
                        <div class="status-legend-dot vd"></div>
                        <span>VD - 空脏房</span>
                    </div>
                    <div class="status-legend-item">
                        <div class="status-legend-dot oc"></div>
                        <span>OC - 住客净房</span>
                    </div>
                    <div class="status-legend-item">
                        <div class="status-legend-dot vc"></div>
                        <span>VC - 空净房</span>
                    </div>
                    <div class="status-legend-item">
                        <div class="status-legend-dot small"></div>
                        <span>小整 - 小整房</span>
                    </div>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="name"><i class="fas fa-user"></i> 服务员姓名</label>
                        <input type="text" id="name" placeholder="请输入姓名">
                    </div>

                    <div class="form-group">
                        <label for="room"><i class="fas fa-door-open"></i> 房号</label>
                        <input type="text" id="room" placeholder="如: 1001">
                    </div>

                    <div class="form-group">
                        <label for="status"><i class="fas fa-tasks"></i> 房间状态</label>
                        <select id="status">
                            <option value="VD">VD - 空脏房</option>
                            <option value="OC">OC - 住客净房</option>
                            <option value="VC">VC - 空净房</option>
                            <option value="小整">小整 - 小整房</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="enter-time"><i class="fas fa-clock"></i> 进入时间</label>
                        <input type="text" id="enter-time" placeholder="YYYY-MM-DD HH:MM">
                    </div>

                    <div class="form-group">
                        <label for="exit-time"><i class="fas fa-clock"></i> 出去时间</label>
                        <input type="text" id="exit-time" placeholder="YYYY-MM-DD HH:MM">
                    </div>

                    <div class="form-group" style="display: flex; gap: 10px; align-items: flex-end;">
                        <button class="btn-time" onclick="recordEnterTime()">
                            <i class="fas fa-sign-in-alt"></i> 记录进入
                        </button>
                        <button class="btn-time" onclick="recordExitTime()">
                            <i class="fas fa-sign-out-alt"></i> 记录出去
                        </button>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h2 class="section-title"><i class="fas fa-bed"></i> 布草补充情况</h2>
                <div class="quick-actions">
                    <div class="quick-btn" onclick="setAllItems('linen', 1)">全部补1</div>
                    <div class="quick-btn" onclick="setAllItems('linen', 0)">全部清零</div>
                </div>
                <div id="linen-items" class="items-grid">
                    <!-- 布草物品数字输入框 -->
                </div>
            </div>

            <div class="form-section">
                <h2 class="section-title"><i class="fas fa-pump-soap"></i> 洗漱用品补充情况</h2>
                <div class="quick-actions">
                    <div class="quick-btn" onclick="setAllItems('toiletries', 1)">全部补1</div>
                    <div class="quick-btn" onclick="setAllItems('toiletries', 0)">全部清零</div>
                </div>
                <div id="toiletries-items" class="items-grid">
                    <!-- 洗漱用品数字输入框 -->
                </div>
            </div>

            <div class="form-section">
                <h2 class="section-title"><i class="fas fa-comment-alt"></i> 备注</h2>
                <div class="form-group">
                    <label for="notes">备注信息</label>
                    <textarea id="notes" rows="3" placeholder="如有特殊情况或需要说明的事项，请在此填写..."></textarea>
                </div>

                <div class="quick-actions">
                    <div class="quick-btn" onclick="setNotes('一切正常')">一切正常</div>
                    <div class="quick-btn" onclick="setNotes('房间有异味')">房间有异味</div>
                    <div class="quick-btn" onclick="setNotes('物品损坏')">物品损坏</div>
                    <div class="quick-btn" onclick="setNotes('需要额外补充')">需要额外补充</div>
                    <div class="quick-btn" onclick="setNotes('客人遗留物品')">客人遗留物品</div>
                </div>
            </div>

            <div class="btn-group">
                <button class="btn-primary" onclick="addCleaningRecord()">
                    <i class="fas fa-plus-circle"></i> 保存打扫记录
                </button>
                <button class="btn-secondary" onclick="clearForm()">
                    <i class="fas fa-eraser"></i> 清空表单
                </button>
                <button class="btn-success" onclick="exportData()">
                    <i class="fas fa-download"></i> 导出数据
                </button>
            </div>
        </div>

        <!-- 数据管理 -->
        <div id="data-tab" class="tab-content">
            <div class="form-section">
                <h2 class="section-title"><i class="fas fa-filter"></i> 数据筛选</h2>
                <div class="filter-section">
                    <div class="filter-group">
                        <label>服务员姓名</label>
                        <input type="text" id="filter-name" placeholder="筛选服务员">
                    </div>
                    <div class="filter-group">
                        <label>房号</label>
                        <input type="text" id="filter-room" placeholder="筛选房号">
                    </div>
                    <div class="filter-group">
                        <label>房间状态</label>
                        <select id="filter-status">
                            <option value="">全部</option>
                            <option value="VD">VD - 空脏房</option>
                            <option value="OC">OC - 住客净房</option>
                            <option value="VC">VC - 空净房</option>
                            <option value="小整">小整 - 小整房</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>日期范围</label>
                        <input type="date" id="filter-date-start">
                    </div>
                    <div class="filter-group">
                        <label>至</label>
                        <input type="date" id="filter-date-end">
                    </div>
                    <div class="filter-group">
                        <button class="btn-primary" onclick="filterData()" style="margin-top: 25px;">
                            <i class="fas fa-search"></i> 筛选
                        </button>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h2 class="section-title"><i class="fas fa-list-alt"></i> 打扫记录列表</h2>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="total-count">0</div>
                        <div class="stat-label">总记录数</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="cleaned-count">0</div>
                        <div class="stat-label">已打扫房间</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="avg-time">0</div>
                        <div class="stat-label">平均时长(分钟)</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="recent-room">-</div>
                        <div class="stat-label">最近打扫</div>
                    </div>
                </div>

                <div id="dataList" class="data-list">
                    <div class="empty-state">
                        <i class="fas fa-inbox"></i>
                        <p>暂无打扫记录，请先添加第一条记录</p>
                    </div>
                </div>
            </div>

            <!-- 管理员数据导出功能 -->
            <div id="admin-export-area" class="admin-export-section" style="display: none;">
                <h3><i class="fas fa-file-export"></i> 管理员数据导出</h3>
                <p>导出系统中所有用户的所有打扫记录数据，方便进行数据分析和备份。</p>
                <div class="admin-export-controls">
                    <button class="btn-export-all" onclick="exportAllData()">
                        <i class="fas fa-download"></i> 导出所有用户数据
                    </button>
                </div>
            </div>
        </div>

        <!-- 统计分析 -->
        <div id="summary-tab" class="tab-content">
            <div class="summary-card">
                <h2 class="section-title"><i class="fas fa-chart-pie"></i> 打扫数据统计</h2>
                <div class="summary-grid">
                    <div class="summary-item">
                        <div class="count" id="summary-total">0</div>
                        <div class="label">总记录数</div>
                    </div>
                    <div class="summary-item">
                        <div class="count" id="summary-cleaned">0</div>
                        <div class="label">已打扫房间</div>
                    </div>
                    <div class="summary-item">
                        <div class="count" id="summary-pending">0</div>
                        <div class="label">待打扫房间</div>
                    </div>
                    <div class="summary-item">
                        <div class="count" id="summary-avg-time">0</div>
                        <div class="label">平均打扫时长(分钟)</div>
                    </div>
                    <div class="summary-item">
                        <div class="count" id="summary-most-productive">-</div>
                        <div class="label">最高效服务员</div>
                    </div>
                    <div class="summary-item">
                        <div class="count" id="summary-busiest-room">-</div>
                        <div class="label">最繁忙房间</div>
                    </div>
                </div>

                <div class="status-legend" style="margin-top: 20px;">
                    <div class="status-legend-item">
                        <div class="status-legend-dot vd"></div>
                        <span>VD - 空脏房: 需要打扫</span>
                    </div>
                    <div class="status-legend-item">
                        <div class="status-legend-dot oc"></div>
                        <span>OC - 住客净房: 已打扫</span>
                    </div>
                    <div class="status-legend-item">
                        <div class="status-legend-dot vc"></div>
                        <span>VC - 空净房: 已打扫</span>
                    </div>
                    <div class="status-legend-item">
                        <div class="status-legend-dot small"></div>
                        <span>小整 - 小整房: 需要打扫</span>
                    </div>
                </div>
            </div>

            <div class="summary-card">
                <h2 class="section-title"><i class="fas fa-boxes"></i> 布草补充总量统计</h2>
                <div id="linen-total-summary" class="items-summary-list">
                    <!-- 布草总量统计 -->
                </div>
            </div>

            <div class="summary-card">
                <h2 class="section-title"><i class="fas fa-pump-soap"></i> 洗漱用品补充总量统计</h2>
                <div id="toiletries-total-summary" class="items-summary-list">
                    <!-- 洗漱用品总量统计 -->
                </div>
            </div>

            <div class="summary-card">
                <h2 class="section-title"><i class="fas fa-hotel"></i> 房间状态分布</h2>
                <div id="status-summary">
                    <!-- 动态生成状态统计 -->
                </div>
            </div>

            <div class="form-section">
                <div class="btn-group">
                    <button class="btn-danger" onclick="clearAllData()">
                        <i class="fas fa-trash-alt"></i> 清空所有数据
                    </button>
                    <button class="btn-secondary" onclick="exportData()">
                        <i class="fas fa-file-export"></i> 导出完整数据
                    </button>
                    <button class="btn-success" onclick="generateReport()">
                        <i class="fas fa-file-alt"></i> 生成报告
                    </button>
                </div>
            </div>
        </div>

        <!-- 管理员面板（仅管理员可见） -->
        <div id="admin-tab" class="tab-content" style="display: none;">
            <div class="admin-section">
                <h3><i class="fas fa-shield-alt"></i> 管理员面板</h3>
                <p>您是系统管理员，可以查看所有用户的数据和进行系统管理。</p>
                <div class="admin-controls">
                    <button class="btn-danger" onclick="clearAllUserData()">
                        <i class="fas fa-exclamation-triangle"></i> 清空所有用户数据
                    </button>
                    <button class="btn-export-all" onclick="exportAllData()">
                        <i class="fas fa-file-export"></i> 导出所有用户数据
                    </button>
                    <button class="btn-success" onclick="generateAdminReport()">
                        <i class="fas fa-file-alt"></i> 生成管理员报告
                    </button>
                </div>
            </div>

            <div class="form-section">
                <h2 class="section-title"><i class="fas fa-users"></i> 用户管理</h2>
                <div id="user-list" class="user-list">
                    <!-- 动态生成用户列表 -->
                </div>
            </div>

            <div class="form-section">
                <h2 class="section-title"><i class="fas fa-database"></i> 所有用户数据统计</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="admin-total-users">0</div>
                        <div class="stat-label">总用户数</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="admin-total-records">0</div>
                        <div class="stat-label">总记录数</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="admin-total-rooms">0</div>
                        <div class="stat-label">打扫房间数</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="admin-total-time">0</div>
                        <div class="stat-label">总时长(分钟)</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="notification" class="notification"></div>

    <script>
        // 系统配置
        const ADMIN_USERNAME = 'admin'; // 管理员用户名
        const ADMIN_PASSWORD = 'admin123'; // 管理员密码（示例）
        // 数据存储
        let currentUser = null;
        let users = [];
        let cleaningRecords = [];

        // 物品字段映射（布草类）
        const linenItems = {
            'big-sheet': '大床单',
            'big-quilt': '大被套',
            'big-pillow': '大枕套',
            'small-sheet': '小床单',
            'small-quilt': '小被套',
            'small-pillow': '小枕套',
            'bath-towel': '浴巾',
            'hand-towel': '毛巾',
            'face-towel': '方巾',
            'floor-towel': '地巾'
        };

        // 物品字段映射（洗漱用品类）
        const toiletriesItems = {
            'tooth-set': '牙具',
            'comb': '梳子',
            'razor': '剃须刀',
            'shower-cap': '浴帽',
            'shampoo': '洗发水',
            'body-wash': '沐浴露',
            'conditioner': '护发素',
            'lotion': '润肤露',
            'sewing-kit': '针线包',
            'waste-bag': '卫生袋',
            'care-kit': '护理包',
            'pen': '圆珠笔',
            'water': '矿泉水',
            'soap': '小肥皂',
            'shopping-bag': '购物袋',
            'shoe-cloth': '擦鞋布',
            'tissue': '面巾纸',
            'bath-scrub': '浴擦',
            'pencil': '铅笔',
            'slippers': '拖鞋',
            'toilet-paper': '卷纸',
            'coffee': '咖啡',
            'creamer': '伴侣',
            'sugar': '白糖',
            'black-tea': '红茶',
            'green-tea': '绿茶'
        };

        // 房间状态映射
        const statusMap = {
            'VD': '空脏房',
            'OC': '住客净房',
            'VC': '空净房',
            '小整': '小整房'
        };

        // 页面加载时初始化
        window.onload = function() {
            // 加载本地存储数据
            loadAppData();

            // 检查用户登录状态
            checkLoginStatus();
        };

        // 加载应用数据
        function loadAppData() {
            const usersData = localStorage.getItem('hotelUsers');
            if (usersData) {
                users = JSON.parse(usersData);
            }

            const recordsData = localStorage.getItem('cleaningRecords');
            if (recordsData) {
                cleaningRecords = JSON.parse(recordsData);
            }
        }

        // 保存应用数据
        function saveAppData() {
            localStorage.setItem('hotelUsers', JSON.stringify(users));
            localStorage.setItem('cleaningRecords', JSON.stringify(cleaningRecords));
        }

        // 检查登录状态
        function checkLoginStatus() {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showAppScreen();
            } else {
                showAuthScreen();
            }
        }

        // 显示登录/注册界面
        function showAuthScreen() {
            document.getElementById('auth-screen').style.display = 'block';
            document.getElementById('app-screen').style.display = 'none';
            switchAuthTab('login');
        }

        // 显示应用界面
        function showAppScreen() {
            document.getElementById('auth-screen').style.display = 'none';
            document.getElementById('app-screen').style.display = 'block';

            // 更新用户信息显示
            updateUserInfo();

            // 生成标签页（根据用户角色）
            generateAppTabs();

            // 确保物品输入框被初始化
            setTimeout(() => {
                initializeItemInputs();
            }, 100); // 稍微延迟确保DOM已加载

            // 更新UI
            updateUI();

            // 显示欢迎消息
            showLoginStatus(`欢迎回来，${currentUser.username}！${currentUser.role === 'admin' ? '您是管理员' : ''}`, 'success');

            // 根据用户角色显示/隐藏管理员导出区域
            updateAdminExportArea();
        }

        // 更新用户信息显示
        function updateUserInfo() {
            document.getElementById('current-user-name').textContent = currentUser.username;
            const badge = document.getElementById('user-role-badge');
            badge.textContent = currentUser.role === 'admin' ? '管理员' : '用户';
            badge.className = currentUser.role === 'admin' ? 'user-badge admin-badge' : 'user-badge';
        }

        // 生成应用标签页（根据用户角色）
        function generateAppTabs() {
            const tabsContainer = document.getElementById('app-tabs');
            let tabsHTML = '';

            // 普通用户只能看到"打扫记录"标签页
            if (currentUser.role !== 'admin') {
                tabsHTML = `
                    <div class="tab active" onclick="switchTab('form')">
                        <i class="fas fa-edit"></i> 打扫记录
                    </div>
                `;
            } else {
                // 管理员可以看到所有标签页
                tabsHTML = `
                    <div class="tab active" onclick="switchTab('form')">
                        <i class="fas fa-edit"></i> 打扫记录
                    </div>
                    <div class="tab" onclick="switchTab('data')">
                        <i class="fas fa-list"></i> 数据管理
                    </div>
                    <div class="tab" onclick="switchTab('summary')">
                        <i class="fas fa-chart-bar"></i> 统计分析
                    </div>
                    <div class="tab" onclick="switchTab('admin')">
                        <i class="fas fa-shield-alt"></i> 管理面板
                    </div>
                `;
            }

            tabsContainer.innerHTML = tabsHTML;
        }

        // 更新管理员导出区域显示
        function updateAdminExportArea() {
            const adminExportArea = document.getElementById('admin-export-area');
            if (currentUser.role === 'admin') {
                adminExportArea.style.display = 'block';
            } else {
                adminExportArea.style.display = 'none';
            }
        }

        // 初始化物品输入框
        function initializeItemInputs() {
            // 布草物品输入框
            const linenContainer = document.getElementById('linen-items');
            if (linenContainer) {
                linenContainer.innerHTML = '';
                for (const [id, name] of Object.entries(linenItems)) {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'item-input-group';
                    itemDiv.innerHTML = `
                        <label>${name}</label>
                        <input type="number" class="number-input" id="${id}" min="0" max="99" value="0" placeholder="0">
                    `;
                    linenContainer.appendChild(itemDiv);
                }
            }

            // 洗漱用品输入框
            const toiletriesContainer = document.getElementById('toiletries-items');
            if (toiletriesContainer) {
                toiletriesContainer.innerHTML = '';
                for (const [id, name] of Object.entries(toiletriesItems)) {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'item-input-group';
                    itemDiv.innerHTML = `
                        <label>${name}</label>
                        <input type="number" class="number-input" id="${id}" min="0" max="99" value="0" placeholder="0">
                    `;
                    toiletriesContainer.appendChild(itemDiv);
                }
            }
        }

        // 切换认证标签
        function switchAuthTab(tab) {
            // 更新标签样式
            document.querySelectorAll('.auth-tab').forEach(authTab => {
                authTab.classList.remove('active');
            });
            event.target.classList.add('active');

            // 更新表单显示
            document.querySelectorAll('.auth-form').forEach(form => {
                form.classList.remove('active');
            });
            document.getElementById(`${tab}-form`).classList.add('active');
        }

        // 登录
        function login() {
            const username = document.getElementById('login-username').value.trim();
            const password = document.getElementById('login-password').value;

            if (!username || !password) {
                showNotification('请输入用户名和密码！', 'error');
                return;
            }

            // 检查是否是管理员
            if (username === ADMIN_USERNAME && password === ADMIN_PASSWORD) {
                currentUser = {
                    username: ADMIN_USERNAME,
                    role: 'admin',
                    createdAt: new Date().toISOString()
                };

                // 保存到本地存储
                localStorage.setItem('currentUser', JSON.stringify(currentUser));

                // 显示应用界面
                showAppScreen();
                return;
            }

            // 检查普通用户
            const user = users.find(u => u.username === username && u.password === password);

            if (user) {
                currentUser = user;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                showAppScreen();
            } else {
                showNotification('用户名或密码错误！', 'error');
            }
        }

        // 注册
        function register() {
            const username = document.getElementById('register-username').value.trim();
            const password = document.getElementById('register-password').value;
            const confirm = document.getElementById('register-confirm').value;

            if (!username || !password) {
                showNotification('请输入用户名和密码！', 'error');
                return;
            }

            if (password !== confirm) {
                showNotification('两次输入的密码不一致！', 'error');
                return;
            }

            // 检查用户名是否被占用（包括管理员）
            if (username === ADMIN_USERNAME) {
                showNotification('用户名"admin"为管理员账号，不可注册！', 'error');
                return;
            }

            if (users.some(u => u.username === username)) {
                showNotification('该用户名已被注册！', 'error');
                return;
            }

            // 创建新用户
            const newUser = {
                username: username,
                password: password,
                role: 'user',
                createdAt: new Date().toISOString()
            };

            users.push(newUser);
            saveAppData();

            showNotification('注册成功！请登录。', 'success');
            switchAuthTab('login');

            // 清空表单
            document.getElementById('register-username').value = '';
            document.getElementById('register-password').value = '';
            document.getElementById('register-confirm').value = '';
        }

        // 退出登录
        function logout() {
            if (confirm('确定要退出登录吗？')) {
                currentUser = null;
                localStorage.removeItem('currentUser');
                showAuthScreen();
                showLoginStatus('已退出登录', 'warning');
            }
        }

        //显示登录状态
        function showLoginStatus(message, type = 'success') {
            const status = document.getElementById('loginStatus');
            status.textContent = message;
            status.className = `login-status show ${type}`;

            setTimeout(() => {
                status.classList.remove('show');
            }, 3000);
        }

        // 设置所有物品数量
        function setAllItems(category, value) {
            const items = category === 'linen' ? linenItems : toiletriesItems;
            for (const id in items) {
                const input = document.getElementById(id);
                if (input) {
                    input.value = value;
                }
            }
            showNotification(`已将${category === 'linen' ? '布草' : '洗漱用品'}全部设置为${value}`);
        }

        //切换标签
        function switchTab(tabName) {
            // 更新标签样式
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.closest('.tab').classList.add('active');

            // 更新内容显示
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            const tabContent = document.getElementById(`${tabName}-tab`);
            if (tabContent) {
                tabContent.classList.add('active');
            }

            // 更新UI
            if (tabName === 'data') {
                updateDataTab();
            } else if (tabName === 'summary') {
                updateSummaryTab();
            } else if (tabName === 'admin' && currentUser.role === 'admin') {
                updateAdminTab();
            }

            // 如果是打扫记录标签，确保物品输入框被初始化
            if (tabName === 'form') {
                setTimeout(() => {
                    initializeItemInputs();
                }, 50);
            }
        }

        // 记录进入时间
        function recordEnterTime() {
            const now = new Date();
            const formattedTime = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')} ${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
            document.getElementById('enter-time').value = formattedTime;
            showNotification('进入时间已记录');
        }

        // 记录出去时间
        function recordExitTime() {
            const now = new Date();
            const formattedTime = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')} ${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
            document.getElementById('exit-time').value = formattedTime;
            showNotification('出去时间已记录');
        }

        // 设置备注
        function setNotes(note) {
            document.getElementById('notes').value = note;
        }

        // 添加打扫记录
        function addCleaningRecord() {
            const name = document.getElementById('name').value.trim();
            const room = document.getElementById('room').value.trim();
            const status = document.getElementById('status').value;
            const enterTime = document.getElementById('enter-time').value;
            const exitTime = document.getElementById('exit-time').value;
            const notes = document.getElementById('notes').value.trim();

            // 验证
            if (!name || !room) {
                showNotification('请至少填写服务员姓名和房号！', 'error');
                return;
            }

            if (!enterTime) {
                showNotification('请记录进入时间！', 'error');
                return;
            }

            // 收集物品补充数量
            const items = {};

            // 收集布草数量
            for (const id in linenItems) {
                const input = document.getElementById(id);
                if (input) {
                    const value = parseInt(input.value) || 0;
                    items[id] = value;
                } else {
                    items[id] = 0;
                }
            }

            // 收集洗漱用品数量
            for (const id in toiletriesItems) {
                const input = document.getElementById(id);
                if (input) {
                    const value = parseInt(input.value) || 0;
                    items[id] = value;
                } else {
                    items[id] = 0;
                }
            }

            // 计算打扫时长（分钟）
            let duration = 0;
            if (enterTime && exitTime) {
                const enter = new Date(enterTime.replace(' ', 'T'));
                const exit = new Date(exitTime.replace(' ', 'T'));
                duration = Math.round((exit - enter) / (1000 * 60));
            }

            // 创建记录对象
            const record = {
                id: Date.now(),
                name,
                room,
                status,
                enterTime,
                exitTime,
                duration,
                items,
                notes,
                timestamp: new Date().toLocaleString(),
                createdBy: currentUser.username // 记录创建者
            };

            // 添加到数组
            cleaningRecords.push(record);

            // 保存到本地存储
            saveAppData();

            // 更新UI
            updateUI();

            // 清空表单
            clearForm();

            showNotification('打扫记录保存成功！');
        }

        // 清空表单
        function clearForm() {
            document.getElementById('name').value = '';
            document.getElementById('room').value = '';
            document.getElementById('status').value = 'VD';
            document.getElementById('enter-time').value = '';
            document.getElementById('exit-time').value = '';
            document.getElementById('notes').value = '';

            // 清空所有数字输入框
            document.querySelectorAll('.number-input').forEach(input => {
                input.value = '0';
            });
        }

        // 删除单条记录
        function deleteRecord(id) {
            if (currentUser.role === 'admin') {
                // 管理员可以删除任何记录
                cleaningRecords = cleaningRecords.filter(item => item.id !== id);
            } else {
                // 普通用户只能删除自己的记录
                const record = cleaningRecords.find(r => r.id === id);
                if (record && record.createdBy === currentUser.username) {
                    cleaningRecords = cleaningRecords.filter(item => item.id !== id);
                } else {
                    showNotification('您只能删除自己的记录！', 'error');
                    return;
                }
            }

            saveAppData();
            updateUI();
            showNotification('记录已删除');
        }

        // 清空所有数据
        function clearAllData() {
            if (cleaningRecords.length === 0) {
                showNotification('没有数据可清空', 'error');
                return;
            }

            if (confirm('确定要清空所有打扫记录吗？此操作不可撤销！')) {
                cleaningRecords = [];
                saveAppData();
                updateUI();
                showNotification('所有数据已清空');
            }
        }

        // 筛选数据
        function filterData() {
            const filterName = document.getElementById('filter-name').value.trim().toLowerCase();
            const filterRoom = document.getElementById('filter-room').value.trim().toLowerCase();
            const filterStatus = document.getElementById('filter-status').value;
            const filterDateStart = document.getElementById('filter-date-start').value;
            const filterDateEnd = document.getElementById('filter-date-end').value;

            // 如果没有筛选条件，显示所有数据
            if (!filterName && !filterRoom && !filterStatus && !filterDateStart && !filterDateEnd) {
                updateDataTab();
                return;
            }

            // 过滤数据
            const filteredData = cleaningRecords.filter(record => {
                // 姓名筛选
                if (filterName && !record.name.toLowerCase().includes(filterName)) {
                    return false;
                }

                // 房号筛选
                if (filterRoom && !record.room.toLowerCase().includes(filterRoom)) {
                    return false;
                }

                // 状态筛选
                if (filterStatus && record.status !== filterStatus) {
                    return false;
                }

                // 日期筛选
                if (filterDateStart || filterDateEnd) {
                    const recordDate = record.enterTime.split(' ')[0];
                    if (filterDateStart && recordDate < filterDateStart) {
                        return false;
                    }
                    if (filterDateEnd && recordDate > filterDateEnd) {
                        return false;
                    }
                }

                return true;
            });

            // 更新数据列表
            updateDataList(filteredData);

            // 更新统计信息
            updateStats(filteredData);

            showNotification(`找到 ${filteredData.length} 条记录`);
        }

        // 导出数据
        function exportData() {
            if (cleaningRecords.length === 0) {
                showNotification('没有数据可导出', 'error');
                return;
            }

            // 创建CSV内容
            let csvContent = "data:text/csv;charset=utf-8,";

            // 表头
            const headers = [
                "ID", "服务员", "房号", "房间状态", "进入时间", "出去时间", "打扫时长(分钟)", "备注", "时间戳", "创建者"
            ];

            // 添加布草物品字段
            for (const name of Object.values(linenItems)) {
                headers.push(name);
            }

            // 添加洗漱用品物品字段
            for (const name of Object.values(toiletriesItems)) {
                headers.push(name);
            }

            csvContent += headers.join(",") + "\n";

            // 数据行
            cleaningRecords.forEach(record => {
                const row = [
                    record.id,
                    `"${record.name}"`,
                    `"${record.room}"`,
                    `"${record.status}"`,
                    `"${record.enterTime}"`,
                    `"${record.exitTime}"`,
                    record.duration,
                    `"${record.notes.replace(/"/g, '""')}"`,
                    `"${record.timestamp}"`,
                    `"${record.createdBy}"`
                ];

                // 添加布草数量
                for (const id of Object.keys(linenItems)) {
                    row.push(record.items[id] || 0);
                }

                // 添加洗漱用品数量
                for (const id of Object.keys(toiletriesItems)) {
                    row.push(record.items[id] || 0);
                }

                csvContent += row.join(",") + "\n";
            });

            // 创建下载链接
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `客房打扫记录_${currentUser.username}_${new Date().toLocaleDateString()}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            showNotification('数据已导出为CSV文件');
        }

        // 生成报告
        function generateReport() {
            if (cleaningRecords.length === 0) {
                showNotification('没有数据可生成报告', 'error');
                return;
            }

            // 简单的文本报告
            let report = "客房打扫数据报告\n";
            report += "====================\n\n";
            report += `生成时间: ${new Date().toLocaleString()}\n`;
            report += `用户: ${currentUser.username}\n`;
            report += `总记录数: ${cleaningRecords.length}\n`;

            // 房间状态统计
            const statusCount = { 'VD': 0, 'OC': 0, 'VC': 0, '小整': 0 };
            cleaningRecords.forEach(r => {
                if (statusCount.hasOwnProperty(r.status)) {
                    statusCount[r.status]++;
                }
            });

            report += `房间状态分布:\n`;
            for (const [status, count] of Object.entries(statusCount)) {
                report += `  ${statusMap[status]} (${status}): ${count}\n`;
            }

            // 平均打扫时长
            report += `\n平均打扫时长: ${calculateAverageTime()} 分钟\n\n`;

            // 物品补充总量统计
            report += "物品补充总量统计:\n";

            // 布草类
            report += "【布草类】\n";
            const linenTotal = {};
            for (const id in linenItems) {
                const total = cleaningRecords.reduce((sum, r) => sum + (r.items[id] || 0), 0);
                if (total > 0) {
                    linenTotal[linenItems[id]] = total;
                }
            }

            if (Object.keys(linenTotal).length > 0) {
                for (const [item, total] of Object.entries(linenTotal)) {
                    report += `  ${item}: ${total}\n`;
                }
            } else {
                report += "  暂无布草补充记录\n";
            }

            // 洗漱用品类
            report += "\n【洗漱用品类】\n";
            const toiletriesTotal = {};
            for (const id in toiletriesItems) {
                const total = cleaningRecords.reduce((sum, r) => sum + (r.items[id] || 0), 0);
                if (total > 0) {
                    toiletriesTotal[toiletriesItems[id]] = total;
                }
            }

            if (Object.keys(toiletriesTotal).length > 0) {
                for (const [item, total] of Object.entries(toiletriesTotal)) {
                    report += `  ${item}: ${total}\n`;
                }
            } else {
                report += "  暂无洗漱用品补充记录\n";
            }

            // 最繁忙房间
            const roomCount = {};
            cleaningRecords.forEach(r => {
                roomCount[r.room] = (roomCount[r.room] || 0) + 1;
            });
            const busiestRoom = Object.entries(roomCount).sort((a, b) => b[1] - a[1])[0];

            if (busiestRoom) {
                report += `\n最繁忙房间: ${busiestRoom[0]} (${busiestRoom[1]} 次)\n`;
            }

            // 最高效服务员
            const cleanerCount = {};
            cleaningRecords.forEach(r => {
                cleanerCount[r.name] = (cleanerCount[r.name] || 0) + 1;
            });
            const mostProductive = Object.entries(cleanerCount).sort((a, b) => b[1] - a[1])[0];

            if (mostProductive) {
                report += `最高效服务员: ${mostProductive[0]} (${mostProductive[1]} 次)\n`;
            }

            // 创建文本文件
            const blob = new Blob([report], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `客房打扫报告_${currentUser.username}_${new Date().toLocaleDateString()}.txt`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            showNotification('报告已生成并下载');
        }

        // 保存到本地存储
        function saveAppData() {
            localStorage.setItem('hotelUsers', JSON.stringify(users));
            localStorage.setItem('cleaningRecords', JSON.stringify(cleaningRecords));
        }

        // 更新UI
        function updateUI() {
            updateDataTab();
            updateSummaryTab();
        }

        // 更新数据标签页
        function updateDataTab() {
            // 普通用户只能看到自己的数据，管理员可以看到所有数据
            const dataToDisplay = currentUser.role === 'admin'
                ? cleaningRecords
                : cleaningRecords.filter(r => r.createdBy === currentUser.username);

            updateDataList(dataToDisplay);
            updateStats(dataToDisplay);
        }

        // 更新数据列表
        function updateDataList(data) {
            const dataList = document.getElementById('dataList');

            if (data.length === 0) {
                dataList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-inbox"></i>
                        <p>${currentUser.role === 'admin' ? '暂无打扫记录，请先添加第一条记录' : '您还没有添加打扫记录，请先添加第一条记录'}</p>
                    </div>
                `;
                return;
            }

            let html = '';
            // 按时间倒序显示（最新的在上面）
            [...data].reverse().forEach(record => {
                // 收集有补充的物品
                const linenItemsList = [];
                const toiletriesItemsList = [];

                for (const [id, name] of Object.entries(linenItems)) {
                    const count = record.items[id] || 0;
                    if (count > 0) {
                        linenItemsList.push(`${name}×${count}`);
                    }
                }

                for (const [id, name] of Object.entries(toiletriesItems)) {
                    const count = record.items[id] || 0;
                    if (count > 0) {
                        toiletriesItemsList.push(`${name}×${count}`);
                    }
                }

                const linenText = linenItemsList.length > 0
                    ? linenItemsList.slice(0, 3).join('、') + (linenItemsList.length > 3 ? `等${linenItemsList.length}项` : '')
                    : '无补充';

                const toiletriesText = toiletriesItemsList.length > 0
                    ? toiletriesItemsList.slice(0, 3).join('、') + (toiletriesItemsList.length > 3 ? `等${toiletriesItemsList.length}项` : '')
                    : '无补充';

                // 根据状态设置CSS类
                let statusClass = '';
                if (record.status === 'VD') statusClass = 'status-vd';
                else if (record.status === 'OC') statusClass = 'status-oc';
                else if (record.status === 'VC') statusClass = 'status-vc';
                else if (record.status === '小整') statusClass = 'status-small';

                // 显示创建者信息（管理员可见）
                const createdByHTML = currentUser.role === 'admin'
                    ? `<div class="data-field"><span class="label">创建者:</span><span class="value">${record.createdBy}</span></div>`
                    : '';

                html += `
                    <div class="data-item">
                        <div class="data-header">
                            <div class="data-room">${record.room}</div>
                            <div class="data-time">${record.enterTime} - ${record.exitTime}</div>
                        </div>
                        <div class="data-info">
                            <div class="data-field">
                                <span class="label">服务员:</span>
                                <span class="value">${record.name}</span>
                            </div>
                            <div class="data-field">
                                <span class="label">状态:</span>
                                <span class="value"><span class="status-badge ${statusClass}">${record.status}</span> ${statusMap[record.status]}</span>
                            </div>
                            <div class="data-field">
                                <span class="label">时长:</span>
                                <span class="value">${record.duration || 0}分钟</span>
                            </div>
                            <div class="data-field">
                                <span class="label">布草补充:</span>
                                <span class="value">${linenText}</span>
                            </div>
                            <div class="data-field">
                                <span class="label">洗漱用品:</span>
                                <span class="value">${toiletriesText}</span>
                            </div>
                            ${createdByHTML}
                            ${record.notes ? `
                            <div class="data-field">
                                <span class="label">备注:</span>
                                <span class="value">${record.notes}</span>
                            </div>
                            ` : ''}
                        </div>
                        <div class="data-actions">
                            <button class="btn-danger" onclick="deleteRecord(${record.id})">
                                <i class="fas fa-trash"></i> 删除
                            </button>
                        </div>
                    </div>
                `;
            });

            dataList.innerHTML = html;
        }

        // 更新统计信息
        function updateStats(data) {
            // 总记录数
            document.getElementById('total-count').textContent = data.length;

            // 已打扫房间数 (OC和VC)
            const cleanedCount = data.filter(r => r.status === 'OC' || r.status === 'VC').length;
            document.getElementById('cleaned-count').textContent = cleanedCount;

            // 平均时长
            const avgTime = calculateAverageTime(data);
            document.getElementById('avg-time').textContent = avgTime;

            // 最近打扫
            if (data.length > 0) {
                const latest = [...data].sort((a, b) => new Date(b.enterTime) - new Date(a.enterTime))[0];
                document.getElementById('recent-room').textContent = latest.room;
            } else {
                document.getElementById('recent-room').textContent = '-';
            }
        }

        // 计算平均时长
        function calculateAverageTime(data = cleaningRecords) {
            const validRecords = data.filter(r => r.duration > 0);
            if (validRecords.length === 0) return 0;
            const total = validRecords.reduce((sum, r) => sum + r.duration, 0);
            return Math.round(total / validRecords.length);
        }

        // 更新统计标签页
        function updateSummaryTab() {
            // 普通用户只能看到自己的数据，管理员可以看到所有数据
            const dataToDisplay = currentUser.role === 'admin'
                ? cleaningRecords
                : cleaningRecords.filter(r => r.createdBy === currentUser.username);

            // 基本统计
            const total = dataToDisplay.length;

            // 已打扫房间数 (OC和VC)
            const cleaned = dataToDisplay.filter(r => r.status === 'OC' || r.status === 'VC').length;

            // 待打扫房间数 (VD和小整)
            const pending = dataToDisplay.filter(r => r.status === 'VD' || r.status === '小整').length;

            const avgTime = calculateAverageTime(dataToDisplay);

            // 最高效服务员
            const cleanerCount = {};
            dataToDisplay.forEach(r => {
                cleanerCount[r.name] = (cleanerCount[r.name] || 0) + 1;
            });
            const mostProductive = Object.entries(cleanerCount).sort((a, b) => b[1] - a[1])[0];

            // 最繁忙房间
            const roomCount = {};
            dataToDisplay.forEach(r => {
                roomCount[r.room] = (roomCount[r.room] || 0) + 1;
            });
            const busiestRoom = Object.entries(roomCount).sort((a, b) => b[1] - a[1])[0];

            // 更新显示
            document.getElementById('summary-total').textContent = total;
            document.getElementById('summary-cleaned').textContent = cleaned;
            document.getElementById('summary-pending').textContent = pending;
            document.getElementById('summary-avg-time').textContent = avgTime;
            document.getElementById('summary-most-productive').textContent = mostProductive ? mostProductive[0] : '-';
            document.getElementById('summary-busiest-room').textContent = busiestRoom ? busiestRoom[0] : '-';

            // 布草总量统计
            const linenTotalSummary = document.getElementById('linen-total-summary');

            if (dataToDisplay.length === 0) {
                linenTotalSummary.innerHTML = '<div class="empty-state"><p>暂无数据</p></div>';
            } else {
                let html = '';
                let hasData = false;

                for (const [id, name] of Object.entries(linenItems)) {
                    const total = dataToDisplay.reduce((sum, r) => sum + (r.items[id] || 0), 0);
                    if (total > 0) {
                        hasData = true;
                        html += `
                            <div class="items-summary-item">
                                <span class="name">${name}</span>
                                <span class="count">${total}</span>
                            </div>
                        `;
                    }
                }

                if (!hasData) {
                    linenTotalSummary.innerHTML = '<div class="empty-state"><p>暂无布草补充记录</p></div>';
                } else {
                    linenTotalSummary.innerHTML = html;
                }
            }

            // 洗漱用品总量统计
            const toiletriesTotalSummary = document.getElementById('toiletries-total-summary');

            if (dataToDisplay.length === 0) {
                toiletriesTotalSummary.innerHTML = '<div class="empty-state"><p>暂无数据</p></div>';
            } else {
                let html = '';
                let hasData = false;

                for (const [id, name] of Object.entries(toiletriesItems)) {
                    const total = dataToDisplay.reduce((sum, r) => sum + (r.items[id] || 0), 0);
                    if (total > 0) {
                        hasData = true;
                        html += `
                            <div class="items-summary-item">
                                <span class="name">${name}</span>
                                <span class="count">${total}</span>
                            </div>
                        `;
                    }
                }

                if (!hasData) {
                    toiletriesTotalSummary.innerHTML = '<div class="empty-state"><p>暂无洗漱用品补充记录</p></div>';
                } else {
                    toiletriesTotalSummary.innerHTML = html;
                }
            }

            // 房间状态统计
            const statusSummary = document.getElementById('status-summary');

            if (dataToDisplay.length === 0) {
                statusSummary.innerHTML = '<div class="empty-state"><p>暂无数据</p></div>';
            } else {
                // 统计各状态数量
                const statusCounts = { 'VD': 0, 'OC': 0, 'VC': 0, '小整': 0 };
                dataToDisplay.forEach(r => {
                    if (statusCounts.hasOwnProperty(r.status)) {
                        statusCounts[r.status]++;
                    }
                });

                let html = '<div class="summary-grid">';

                for (const [status, count] of Object.entries(statusCounts)) {
                    if (count > 0) {
                        const percentage = Math.round((count / dataToDisplay.length) * 100);
                        html += `
                            <div class="summary-item">
                                <div class="count">${count}</div>
                                <div class="label">${statusMap[status]} (${status})</div>
                                <div class="progress-bar" style="margin-top: 8px;">
                                    <div class="progress-fill" style="width: ${percentage}%"></div>
                                </div>
                                <div style="font-size: 0.8rem; margin-top: 5px;">${percentage}%</div>
                            </div>
                        `;
                    }
                }

                html += '</div>';
                statusSummary.innerHTML = html;
            }
        }

        // 更新管理员标签页
        function updateAdminTab() {
            if (currentUser.role !== 'admin') return;

            // 更新用户列表
            updateUserList();

            // 更新管理员统计数据
            updateAdminStats();
        }

        // 更新用户列表
        function updateUserList() {
            const userListContainer = document.getElementById('user-list');

            if (users.length === 0) {
                userListContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-users"></i>
                        <p>暂无用户，请先注册用户</p>
                    </div>
                `;
                return;
            }

            let html = '';

            users.forEach(user => {
                // 计算用户数据统计
                const userRecords = cleaningRecords.filter(r => r.createdBy === user.username);
                const recordCount = userRecords.length;
                const roomCount = new Set(userRecords.map(r => r.room)).size;

                //检查是否可以删除（不能删除管理员和当前登录用户）
                const canDelete = user.username !== ADMIN_USERNAME && user.username !== currentUser.username;

                html += `
                    <div class="user-card ${user.role === 'admin' ? 'admin' : ''}">
                        <div class="user-name">${user.username}</div>
                        <span class="user-role ${user.role}">${user.role === 'admin' ? '管理员' : '用户'}</span>
                        <div class="user-stats">
                            <span><i class="fas fa-database"></i> ${recordCount} 条记录</span>
                            <span><i class="fas fa-door-open"></i> ${roomCount} 个房间</span>
                        </div>
                        <div class="user-actions">
                            <button class="btn-danger" onclick="deleteUser('${user.username}')" ${!canDelete ? 'disabled' : ''}>
                                <i class="fas fa-trash"></i> 删除
                            </button>
                        </div>
                    </div>
                `;
            });

            userListContainer.innerHTML = html;
        }

        // 更新管理员统计数据
        function updateAdminStats() {
            // 总用户数
            document.getElementById('admin-total-users').textContent = users.length;

            // 总记录数
            document.getElementById('admin-total-records').textContent = cleaningRecords.length;

            // 打扫房间数
            const uniqueRooms = new Set(cleaningRecords.map(r => r.room));
            document.getElementById('admin-total-rooms').textContent = uniqueRooms.size;

            // 总时长
            const totalTime = cleaningRecords.reduce((sum, r) => sum + (r.duration || 0), 0);
            document.getElementById('admin-total-time').textContent = totalTime;
        }

        // 删除用户
        function deleteUser(username) {
            if (username === ADMIN_USERNAME) {
                showNotification('不能删除管理员账号！', 'error');
                return;
            }

            if (username === currentUser.username) {
                showNotification('不能删除当前登录用户！', 'error');
                return;
            }

            if (confirm(`确定要删除用户"${username}"吗？所有该用户的数据也将被删除。`)) {
                // 删除用户
                users = users.filter(u => u.username !== username);

                // 删除该用户的所有记录
                cleaningRecords = cleaningRecords.filter(r => r.createdBy !== username);

                // 保存数据
                saveAppData();

                // 更新UI
                updateAdminTab();
                updateDataTab();
                updateSummaryTab();

                showNotification(`用户"${username}"已删除`);
            }
        }

        // 清空所有用户数据（管理员专用）
        function clearAllUserData() {
            if (confirm('确定要清空所有用户的所有数据吗？此操作不可撤销！')) {
                cleaningRecords = [];
                saveAppData();

                // 更新UI
                updateAdminTab();
                updateDataTab();
                updateSummaryTab();

                showNotification('所有用户数据已清空');
            }
        }

        // 导出所有用户数据（管理员专用）
        function exportAllData() {
            if (cleaningRecords.length === 0) {
                showNotification('没有数据可导出', 'error');
                return;
            }

            // 创建CSV内容
            let csvContent = "data:text/csv;charset=utf-8,";

            // 表头
            const headers = [
                "ID", "服务员", "房号", "房间状态", "进入时间", "出去时间", "打扫时长(分钟)", "备注", "时间戳", "创建者"
            ];

            // 添加布草物品字段
            for (const name of Object.values(linenItems)) {
                headers.push(name);
            }

            // 添加洗漱用品物品字段
            for (const name of Object.values(toiletriesItems)) {
                headers.push(name);
            }

            csvContent += headers.join(",") + "\n";

            // 数据行
            cleaningRecords.forEach(record => {
                const row = [
                    record.id,
                    `"${record.name}"`,
                    `"${record.room}"`,
                    `"${record.status}"`,
                    `"${record.enterTime}"`,
                    `"${record.exitTime}"`,
                    record.duration,
                    `"${record.notes.replace(/"/g, '""')}"`,
                    `"${record.timestamp}"`,
                    `"${record.createdBy}"`
                ];

                // 添加布草数量
                for (const id of Object.keys(linenItems)) {
                    row.push(record.items[id] || 0);
                }

                // 添加洗漱用品数量
                for (const id of Object.keys(toiletriesItems)) {
                    row.push(record.items[id] || 0);
                }

                csvContent += row.join(",") + "\n";
            });

            // 创建下载链接
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `所有用户打扫记录_${new Date().toLocaleDateString()}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            showNotification('所有用户数据已导出为CSV文件');
        }

        // 生成管理员报告（管理员专用）
        function generateAdminReport() {
            if (cleaningRecords.length === 0) {
                showNotification('没有数据可生成报告', 'error');
                return;
            }

            // 简单的文本报告
            let report = "客房打扫数据管理员报告\n";
            report += "====================\n\n";
            report += `生成时间: ${new Date().toLocaleString()}\n`;
            report += `管理员: ${currentUser.username}\n`;
            report += `总用户数: ${users.length}\n`;
            report += `总记录数: ${cleaningRecords.length}\n`;

            // 房间状态统计
            const statusCount = { 'VD': 0, 'OC': 0, 'VC': 0, '小整': 0 };
            cleaningRecords.forEach(r => {
                if (statusCount.hasOwnProperty(r.status)) {
                    statusCount[r.status]++;
                }
            });

            report += `\n房间状态分布:\n`;
            for (const [status, count] of Object.entries(statusCount)) {
                report += `  ${statusMap[status]} (${status}): ${count}\n`;
            }

            // 平均打扫时长
            report += `\n平均打扫时长: ${calculateAverageTime()} 分钟\n\n`;

            // 各用户数据统计
            report += "各用户数据统计:\n";
            users.forEach(user => {
                const userRecords = cleaningRecords.filter(r => r.createdBy === user.username);
                const recordCount = userRecords.length;
                const roomCount = new Set(userRecords.map(r => r.room)).size;

                report += `  ${user.username} (${user.role}):\n`;
                report += `   记录数: ${recordCount}\n`;
                report += `    房间数: ${roomCount}\n`;

                if (recordCount > 0) {
                    const avgTime = calculateAverageTime(userRecords);
                    report += `    平均时长: ${avgTime} 分钟\n`;
                }
                report += "\n";
            });

            // 创建文本文件
            const blob = new Blob([report], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `管理员报告_${new Date().toLocaleDateString()}.txt`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            showNotification('管理员报告已生成并下载');
        }

        // 显示通知
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');

            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
    </script>
</body>
</html>
